<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="UTF-8" />
  <title>전국 치매안심센터</title>
</head>
<body>
  
<div id="map" style="width:100%;height:500px;"></div>

<!-- 카카오 지도 API 스크립트 -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b08bb0d7029cff05ee0ab4ab533493ce"></script>

<script>
  // 공공데이터포털 API 호출
  fetch('http://api.data.go.kr/openapi/tn_pubr_public_imbclty_cnter_api') // 실제 API 주소와 인증키 포함해야 함
  const serviceKey = 'PGaRDR11RPT4oGwm0d1zVinIrqETQaNooSxuLuV5C56uqGE%2Bcdg1Scr5ZMaWaGcNAXG1v9K1JYgpU8z3SzZoOQ%3D%3D'
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(37.5665, 126.9780), // 초기 지도 중심 좌표 (서울 시청 기준)
        level: 5
      };
      const map = new kakao.maps.Map(container, options);

      // JSON 응답 구조에 따라 경로 조정 필요할 수 있음
      const items = data.items || data.response?.body?.items?.item; // 보통 구조 확인 필요

      items.forEach(item => {
        // 구조 분해로 필요한 필드 추출
        const {
          cnterNm,         // 센터 이름
          rdnmadr,         // 도로명 주소
          latitude,        // 위도
          longitude,       // 경도
          operPhoneNumber  // 전화번호
        } = item;

        // 위도/경도 숫자 변환 (문자열일 수 있음)
        const lat = parseFloat(latitude);
        const lng = parseFloat(longitude);

        // 유효 좌표만 처리
        if (!isNaN(lat) && !isNaN(lng)) {
          const markerPosition = new kakao.maps.LatLng(lat, lng);
          const marker = new kakao.maps.Marker({
            position: markerPosition,
            map: map
          });

          const infowindow = new kakao.maps.InfoWindow({
            content: `
              <div style="padding:5px; font-size:13px;">
                <strong>${cnterNm}</strong><br/>
                ${rdnmadr}<br/>
                📞 ${operPhoneNumber}
              </div>
            `
          });

          kakao.maps.event.addListener(marker, 'click', function () {
            infowindow.open(map, marker);
          });
        }
      });
    })
    .catch(error => {
      console.error('공공데이터 API 오류:', error);
    });
</script>
</body>
